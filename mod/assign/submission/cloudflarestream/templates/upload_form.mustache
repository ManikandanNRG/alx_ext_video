{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template assignsubmission_cloudflarestream/upload_form

    Cloudflare Stream video upload form template.

    Context variables required for this template:
    * assignmentid - The assignment ID
    * submissionid - The submission ID (optional)
    * maxfilesize - Maximum file size in bytes
    * maxfilesizeformatted - Maximum file size formatted for display
    * hasvideo - Whether a video already exists
    * videostatus - Current video status (if exists)
    * videouid - Video UID (if exists)
    * duration - Video duration in seconds (if exists)
    * durationformatted - Video duration formatted for display (if exists)
    * filesize - Video file size in bytes (if exists)
    * filesizeformatted - Video file size formatted for display (if exists)

    Example context (json):
    {
        "assignmentid": 123,
        "submissionid": 456,
        "maxfilesize": 5368709120,
        "maxfilesizeformatted": "5 GB",
        "hasvideo": true,
        "videostatus": "ready",
        "videouid": "abc123",
        "duration": 300,
        "durationformatted": "5 mins",
        "filesize": 104857600,
        "filesizeformatted": "100 MB"
    }
}}

<div class="cloudflarestream-upload-interface" 
     data-assignment-id="{{assignmentid}}" 
     data-submission-id="{{submissionid}}"
     data-max-file-size="{{maxfilesize}}">

    {{#hasvideo}}
    <div class="cloudflarestream-current-status alert alert-info">
        <strong>{{#str}}cloudflarestream, assignsubmission_cloudflarestream{{/str}}:</strong>
        {{#str}}status_{{videostatus}}, assignsubmission_cloudflarestream{{/str}}
    </div>

    {{#videostatus_ready}}
    <div class="cloudflarestream-video-info">
        {{#durationformatted}}
        <div class="cloudflarestream-metadata">
            <i class="fa fa-clock-o" aria-hidden="true"></i>
            {{#str}}duration, core{{/str}}: {{durationformatted}}
        </div>
        {{/durationformatted}}
        
        {{#filesizeformatted}}
        <div class="cloudflarestream-metadata">
            <i class="fa fa-file-video-o" aria-hidden="true"></i>
            {{#str}}size, core{{/str}}: {{filesizeformatted}}
        </div>
        {{/filesizeformatted}}
    </div>
    {{/videostatus_ready}}
    {{/hasvideo}}

    <div class="cloudflarestream-dropzone">
        <div class="cloudflarestream-dropzone-icon">
            <i class="fa fa-cloud-upload fa-3x" aria-hidden="true"></i>
        </div>
        
        <p class="cloudflarestream-dropzone-text">
            {{#str}}dragdrop, assignsubmission_cloudflarestream{{/str}}
        </p>
        
        <p class="cloudflarestream-dropzone-hint text-muted">
            {{#str}}maxfilesize, core{{/str}}: {{maxfilesizeformatted}}
        </p>

        <input type="file" 
               id="cloudflarestream-file-input-{{assignmentid}}" 
               class="cloudflarestream-file-input" 
               accept="video/*" 
               style="display: none;"
               aria-label="{{#str}}selectvideo, assignsubmission_cloudflarestream{{/str}}">

        <button type="button" 
                class="btn btn-secondary cloudflarestream-select-btn">
            <i class="fa fa-folder-open" aria-hidden="true"></i>
            {{#str}}selectvideo, assignsubmission_cloudflarestream{{/str}}
        </button>
    </div>

    <div class="cloudflarestream-progress-container" style="display: none;">
        <div class="cloudflarestream-progress-label">
            <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
            {{#str}}uploading, assignsubmission_cloudflarestream{{/str}}
        </div>

        <div class="progress cloudflarestream-progress-wrapper">
            <div class="progress-bar progress-bar-striped progress-bar-animated cloudflarestream-progress-bar" 
                 role="progressbar" 
                 style="width: 0%"
                 aria-valuenow="0" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
                0%
            </div>
        </div>

        <div class="cloudflarestream-progress-details">
            <span class="cloudflarestream-progress-percentage">0%</span>
            <span class="cloudflarestream-progress-eta"></span>
        </div>
    </div>

    <div class="cloudflarestream-status-message" role="alert" aria-live="polite"></div>
</div>

{{#js}}
require(['assignsubmission_cloudflarestream/uploader'], function(Uploader) {
    Uploader.init({{assignmentid}}, {{submissionid}}, {{maxfilesize}});
});
{{/js}}
