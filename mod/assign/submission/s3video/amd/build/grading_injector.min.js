define(['jquery'],function($){return{init:function(){var urlParams=new URLSearchParams(window.location.search);var action=urlParams.get('action');var rownum=urlParams.get('rownum');var userid=urlParams.get('userid');if(action==='grader'&&(rownum!==null||userid!==null)){setTimeout(()=>{this.injectPlayer();},500);}},injectPlayer:function(){if($('.s3video-two-column-layout').length>0){console.log('S3 Video: Two-column layout already exists, skipping injection');return;}var $readyLink=$('.s3video-watch-link');var $existingPlayers=$('.s3video-grading-view, .s3video-player-container');if($readyLink.length===0&&$existingPlayers.length===0){console.log('S3 Video: No video found on this page');return;}console.log('S3 Video: Found video, injecting two-column layout...');var submissionId,s3key;if($readyLink.length>0){var href=$readyLink.attr('href');var match=href.match(/id=(\d+)/);var s3keyMatch=href.match(/s3key=([^&]+)/);if(!match||!s3keyMatch){console.error('S3 Video: Could not extract video info from link');return;}submissionId=match[1];s3key=decodeURIComponent(s3keyMatch[1]);}else{var $existingPlayer=$existingPlayers.first();submissionId=$existingPlayer.attr('id')?$existingPlayer.attr('id').match(/\d+/)[0]:Date.now();s3key=$existingPlayer.data('s3-key')||'';if(!s3key){console.error('S3 Video: Could not extract s3key from existing player');return;}}var containerId='s3video-player-'+submissionId+'-'+Date.now();this.createTwoColumnLayout($readyLink.length>0?$readyLink:$existingPlayers.first(),containerId,s3key,submissionId);},createTwoColumnLayout:function($videoElement,containerId,s3key,submissionId){console.log('S3 Video: Creating two-column layout...');var $gradingContainer=$videoElement.closest('[data-region="grade-panel"]');if($gradingContainer.length===0){$gradingContainer=$videoElement.closest('.submissionstatustable');if($gradingContainer.length===0){$gradingContainer=$videoElement.closest('.assignment');if($gradingContainer.length===0){$gradingContainer=$videoElement.closest('body');}}}if($gradingContainer.length===0){console.warn('S3 Video: Could not find grading container, using fallback');this.createSimplePlayer($videoElement,containerId,s3key,submissionId);return;}$gradingContainer.find('.s3video-grading-view, .s3video-player-container').remove();var $gradingContent=$gradingContainer.children().not('.s3video-grading-view, .s3video-player-container, .s3video-two-column-layout').clone(true);var twoColumnHtml='<div class="s3video-two-column-layout"><div class="s3video-left-column"><div class="s3video-player-wrapper"><div class="s3video-player-container" id="'+containerId+'"><div class="s3video-loading"><div class="spinner-border text-light" role="status"><span class="sr-only">Loading video...</span></div><p>Loading video player...</p></div></div></div></div><div class="s3video-right-column" id="s3video-grading-panel"><!-- Grading content will be moved here --></div></div>';$gradingContainer.html(twoColumnHtml);var $rightColumn=$gradingContainer.find('#s3video-grading-panel');$rightColumn.append($gradingContent);require(['assignsubmission_s3video/player'],function(Player){console.log('S3 Video: Initializing player with:',{s3key:s3key,submissionId:submissionId,containerId:containerId});Player.init(s3key,submissionId,containerId);});},createSimplePlayer:function($videoElement,containerId,s3key,submissionId){console.log('S3 Video: Creating simple player (fallback)...');var playerHtml='<div class="s3video-grading-view"><div class="s3video-player-wrapper"><div class="s3video-player-container" id="'+containerId+'"><div class="s3video-loading"><div class="spinner-border text-light" role="status"><span class="sr-only">Loading video...</span></div><p>Loading video player...</p></div></div></div></div>';$videoElement.parent().html(playerHtml);require(['assignsubmission_s3video/player'],function(Player){console.log('S3 Video: Initializing player with:',{s3key:s3key,submissionId:submissionId,containerId:containerId});Player.init(s3key,submissionId,containerId);});}}});