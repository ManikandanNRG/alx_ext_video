# Build Instructions for S3 Video Plugin

## AMD JavaScript Modules

The plugin uses AMD (Asynchronous Module Definition) JavaScript modules. These need to be built using Grunt.

### Files Structure

- **amd/src/** - Source JavaScript files (editable)
- **amd/build/** - Minified JavaScript files (generated by Grunt)

### Building on EC2 Server

1. **SSH into your EC2 server**
   ```bash
   ssh your-ec2-server
   ```

2. **Navigate to Moodle root**
   ```bash
   cd /path/to/moodle
   ```

3. **Run Grunt to build AMD modules**
   ```bash
   grunt amd --root=mod/assign/submission/s3video
   ```

   Or build all AMD modules:
   ```bash
   grunt amd
   ```

4. **Purge Moodle caches**
   ```bash
   php admin/cli/purge_caches.php
   ```

### If Grunt is Not Installed

Install Node.js and Grunt:

```bash
# Install Node.js (if not installed)
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt-get install -y nodejs

# Install Grunt CLI globally
sudo npm install -g grunt-cli

# Install Moodle's Grunt dependencies
cd /path/to/moodle
npm install
```

### Development Mode (No Build Required)

For development, you can enable Moodle's development mode which uses unminified JavaScript:

1. Go to: **Site administration → Development → Debugging**
2. Set **Debug messages** to **DEVELOPER**
3. Check **JavaScript debugging**

This will use the source files from `amd/src/` directly without needing to build.

### Current Status

The minified file `amd/build/grading_injector.min.js` has been created manually and should work. However, for production, you should run Grunt to ensure proper minification and source maps.

### Testing

After building, test the grading interface:

1. Go to an assignment with S3 Video submissions
2. Click "View all submissions"
3. Click "Grade" on a submission with a video
4. The video player should appear where "Ready (XX MB)" was shown

### Troubleshooting

**JavaScript not loading:**
- Check browser console (F12) for errors
- Verify file exists: `mod/assign/submission/s3video/amd/build/grading_injector.min.js`
- Purge caches again

**Player not appearing:**
- Check if `view_summary()` is loading the JavaScript
- Verify the CSS class `.s3video-watch-link` exists in the HTML
- Check browser console for "S3 Video:" messages

**Grunt errors:**
- Ensure you're in Moodle root directory
- Run `npm install` to install dependencies
- Check Node.js version (should be 14+ or 16+)
