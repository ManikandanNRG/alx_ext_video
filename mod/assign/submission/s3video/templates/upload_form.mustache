{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template assignsubmission_s3video/upload_form

    S3 Video upload form template.

    Context variables required for this template:
    * assignmentid - The assignment ID
    * submissionid - The submission ID (optional)
    * maxfilesize - Maximum file size in bytes
    * maxfilesizeformatted - Maximum file size formatted for display
    * hasvideo - Whether a video already exists
    * videostatus - Current video status (if exists)
    * s3key - S3 key (if exists)
    * filesize - Video file size in bytes (if exists)
    * filesizeformatted - Video file size formatted for display (if exists)

    Example context (json):
    {
        "assignmentid": 123,
        "submissionid": 456,
        "maxfilesize": 5368709120,
        "maxfilesizeformatted": "5 GB",
        "hasvideo": true,
        "videostatus": "ready",
        "s3key": "videos/123/1698345600_a7b3c/myvideo.mp4",
        "filesize": 104857600,
        "filesizeformatted": "100 MB"
    }
}}

<div class="s3video-upload-interface" 
     data-assignment-id="{{assignmentid}}" 
     data-submission-id="{{submissionid}}"
     data-max-file-size="{{maxfilesize}}">

    {{#hasvideo}}
    <div class="s3video-current-status alert alert-info">
        <strong>{{#str}}s3video, assignsubmission_s3video{{/str}}:</strong>
        {{#str}}status_{{videostatus}}, assignsubmission_s3video{{/str}}
    </div>

    {{#videostatus_ready}}
    <div class="s3video-video-info">
        {{#filesizeformatted}}
        <div class="s3video-metadata">
            <i class="fa fa-file-video-o" aria-hidden="true"></i>
            {{#str}}size, core{{/str}}: {{filesizeformatted}}
        </div>
        {{/filesizeformatted}}
    </div>
    {{/videostatus_ready}}
    {{/hasvideo}}

    <div class="s3video-dropzone">
        <div class="s3video-dropzone-icon">
            <i class="fa fa-cloud-upload fa-3x" aria-hidden="true"></i>
        </div>
        
        <p class="s3video-dropzone-text">
            {{#str}}dragdrop, assignsubmission_s3video{{/str}}
        </p>
        
        <p class="s3video-dropzone-hint text-muted">
            {{#str}}maxfilesize, core{{/str}}: {{maxfilesizeformatted}}
        </p>

        <input type="file" 
               id="s3video-file-input-{{assignmentid}}" 
               class="s3video-file-input" 
               accept="video/*" 
               style="display: none;"
               aria-label="{{#str}}selectvideo, assignsubmission_s3video{{/str}}">

        <button type="button" 
                class="btn btn-secondary s3video-select-btn">
            <i class="fa fa-folder-open" aria-hidden="true"></i>
            {{#str}}selectvideo, assignsubmission_s3video{{/str}}
        </button>
    </div>

    <div class="s3video-progress-container" style="display: none;">
        <div class="s3video-progress-label">
            <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
            {{#str}}uploading, assignsubmission_s3video{{/str}}
        </div>

        <div class="progress s3video-progress-wrapper">
            <div class="progress-bar progress-bar-striped progress-bar-animated s3video-progress-bar" 
                 role="progressbar" 
                 style="width: 0%"
                 aria-valuenow="0" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
                0%
            </div>
        </div>

        <div class="s3video-progress-details">
            <span class="s3video-progress-percentage">0%</span>
        </div>
    </div>

    <div class="s3video-status-message" role="alert" aria-live="polite"></div>
</div>

{{#js}}
require(['assignsubmission_s3video/uploader'], function(Uploader) {
    Uploader.init({{assignmentid}}, {{submissionid}}, {{maxfilesize}}, '.s3video-upload-interface');
});
{{/js}}
